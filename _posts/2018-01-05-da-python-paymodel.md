---
title: "3회차: 결제 예측 모델링 구축"
layout: post
author: songhunhwa
---

### 목적
 - 결제 행동을 예측하는 모델을 구축하고 평가한다.
 - 실제 분석을 진행하는 상황으로 생각하고 실습을 진행한다.
 
### 목차
 1. 문제 정의 및 가설 구축
 2. 분석 Frame 구성
 3. 데이터 전처리
 4. 데이터 분석
 5. 리포트 작성
 
### 문제 정의 및 가설
여러 번 강조해도 지나침이 없을 정도로, 문제를 명확히 정의/설정하고 목표를 세우는 것은 매우 중요하다. 만약 목표가 틀리다면, 아무리 열심히 수고하더라도 큰 의미가 없기 때문이다.(물론 회사 입장에서 그렇다. 개인 입장에서는 경험치 획득에 도움이 될 수는 있다) 이번에는 마케팅팀에서 업무 요청이 왔다고 가정한다. 마케팅팀이 관심을 두는 것은 회원의 행동 패턴을 근거로, 결제로 전환할 유저를 모델을 통해 예측하는 것이 가능한지 여부이다. 

#### 배경
배경 및 상황에 대해 조금더 자세히 살펴보자. 마케팅팀은 주로 예산을 집행하고 이에 따른 결과(성과)를 통해 예산을 효율화하는 것이 관심을 두고 있다. 이를 위해 흔히 알려진 전략이 STP이다. 즉 유저/소비자를 세분화해 그룹으로 나누고, 각 그룹에 맞는 개인화 메시지를 전달하거나 그룹의 우선순위에 따라 예산 및 접근 방식에 차등을 두는 방식을 주로 이용한다. 이번 사례에서는 결제자의 수를 증가시키기 위한 비즈니스 전략을 달성하기 위해 마케팅팀으로부터 결제자 예측 모델링 구축 관련한 업무 요청이 왔다고 가정하고 진행한다.
 
 - 결제자수의 증가에 대한 비즈니스 요구 발생 (마케팅팀 KPI)
 - 유저의 행동을 기반으로, 결제 가능성이 높은 유저를 선별하여 해당 유저를 위주로 타깃팅 (광고, 프로모션 등)
 - 데이터 분석가 뿐만 아니라, 여러 팀의 협업이 필요한 상황
  
#### 목적
이번 사례의 경우 아래와 같이 데이터 분석가의 목적을 설정할 수 있다. 단, 지금 사례와 같이 여러 팀이 협업해서 프로젝트를 진행하는 경우라면 전체 프로젝트의 목적과 각 팀 혹은 파트 별로의 목적을 충분한 논의를 통해 설정하는 것이 필요하다. 

 - 결제자로 전환할 가능성이 높은 유저를 판별하는 모델 구축
 - 예측 모델의 성능을 측정할 수 있는 지표를 정의

<img src="/img/lecture/predmodel.png" width="65%">

#### 가설
이번 사례의 경우 가설을 설정하기 위해 도메인 지식이 많이 요구된다. 도메인 지식과 전문가의 조언 등을 통해 결제와 관련 있는 행동 변수를 사전에 이해하고 리스트업하는 것이 유용하다. 만약 이러한 도움을 받기 어려운 상황이라면, 분석가의 상상력과 직감을 이용해 주요 변수들을 생각해놓고 탐색적 데이터 분석을 통해 Feature Selection을 하는 것이 필요하다. 예를 들어 아래와 
- 가설 1: Open, Edit/Save, Export와 같은 문서 이용행동 관련 변수가 모델 구축에 유의미한 변수일 것
- 가설 2: 문서 사용 트래픽 및 일주일 간 방문일수 역시 결제 행동와 관련 있는 예측 변수일 것

#### 아웃풋
- 타깃팅 유저 정보 테이블 (RDB, 일별 배치)
	- Schema: 날짜, 타깃팅 대상 유저의 아이디, 결제 확률, 결제 예상 여부 (결제 확률 50% 이상일 경우 True, 이하일 경우 False)
- 타깃팅 결과 테이블 (RDB, 일별 배치)
	- Schema: 날짜, 타깃 유저 아이디, 타깃 액티비티, 결제 여부(기존 3일내) 
- 결제 정보 테이블 (기존 Hadoop 저장 테이블)
	- Schema: 날짜, 전체 결제 유저 아이디, 결제일
- 모델 구축 과정 문서(수식) 및 코드
- 모델 성과 측정 대시보드/리포트 (Recall, Precision, AUC, F1-score)

### 분석 Frame
일반적인 모델링 구축을 위한 프로세스를 먼저 살펴보자.

<img src="/img/lecture/class_process.png" width="80%">

Source: [Algoline](http://algolytics.com/tutorial-how-to-determine-the-quality-and-correctness-of-classification-models-part-1-introduction/)





